<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Fetch</title>

    <style>

        body{
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* flex-wrap: wrap; */
            /* justify-content: space-around; */
            min-height: 100vh;
            margin: 0;
            justify-content: center;
        }

        .container{
            /* border: 2px solid black; */
            margin: 25px 0;
            padding: 25px;
            display: flex;
            /* flex-wrap: wrap; */
            flex-direction: column;
            /* height: 400px; */
            gap: 20px;
            width: 90%;
            max-width: 1200px;
            max-height: 400px;
            /* align-items: center; */
            overflow-y: auto;
            overflow-x: auto;
            background: #fee5cf;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-in-out;
            pointer-events: none;
            white-space: nowrap;
        }

        .container::-webkit-scrollbar {
            width: 8px;
        }

        .container::-webkit-scrollbar-thumb {
            background: #ef9185;
            border-radius: 4px;
        }

        .container.show{
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .tables-wrapper {
            display: flex;
            flex-direction: row;   
            gap: 20px;             
            flex-wrap: nowrap;       
            width: 100%;
            justify-content: center;
}

        .results-table{
            /* margin: 20px auto; */
            border-collapse: collapse;
            min-width: 500px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            border-radius: 10px;
            overflow: hidden;
            /* overflow-y: scroll;
            overflow-x: scroll; */
            opacity: 0; 
            transform: translateY(20px); 
            transition: all 0.5s ease-in-out;
        }

        .results-table.show{
            opacity: 1;
            transform: translateY(0);
        }

        .results-table th, .results-table td{
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }

        .results-table th{
            background-color: #ef9185;
            color: white;
        }

        .results-table tr:nth-child(even){
            background-color: #dbdedf;
        }

        .results-table tr:nth-child(odd){
            background-color: white;
        }

        .results-table tr:hover{
            background-color: #f1f1f1;
        }

        .card{
            background-color: #dbdedf;
            /* border: 2px solid black; */
            border-radius: 10px;
            display: flex;
            flex-direction: row;
            align-items: center;
            margin: 10px;
            padding: 10px;
            gap: 15px;
            /* height: 50px; */
            width: fit-content;
            /* flex-wrap: wrap; */
            top: 20px;
            /* align-content: space-around; */
            /* justify-content: space-evenly; */
            position: absolute;
            z-index: 10;
            overflow: visible;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3);
        }

        
        .button-56 {
        align-items: center;
        background-color: #fee6e3;
        border: 2px solid #111;
        border-radius: 8px;
        box-sizing: border-box;
        color: #111;
        cursor: pointer;
        display: flex;
        font-family: Inter,sans-serif;
        font-size: 16px;
        height: 48px;
        justify-content: center;
        line-height: 24px;
        max-width: 100%;
        padding: 0 25px;
        position: relative;
        text-align: center;
        text-decoration: none;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
        
        }

        .button-56:after {
        background-color: #111;
        border-radius: 8px;
        content: "";
        display: block;
        height: 48px;
        left: 0;
        width: 100%;
        position: absolute;
        top: -2px;
        transform: translate(8px, 8px);
        transition: transform .2s ease-out;
        z-index: -1;
        }

        .button-56:hover:after {
        transform: translate(0, 0);
        }

        .button-56:active {
        background-color: #ffdeda;
        outline: 0;
        }

        .button-56:hover {
        outline: 0;
        }

        @media (min-width: 768px) {
        .button-56 {
            padding: 0 40px;
        }
        }      

        .no-data {
            text-align: center;
            font-size: 1.2rem;
            color: #555;
            font-weight: bold;
            padding: 20px;
        }

    </style>


</head>
<body>
    <span class="card">
        <label>Start Date</label>
        <input type="date" id="start_date">
        <label>End Date</label>
        <input type="date" id="end_date">
        <button onclick="fetchReports()" class="button-56" role="button">Submit</button>
        
    </span>
    
    <div class="container" id="results-container">
        <div class="tables-wrapper">

            <!-- <h2>Results:</h2> -->
            <table id="results1" class="results-table">
                <thead>
                    <tr><th>Name</th><th>Date</th><th>Value</th><th>Price</th></tr>
                </thead>
                <tbody></tbody>
            </table>
            
            <table id="results2" class="results-table">
                <thead>
                    <tr><th>Product</th><th>Date2</th><th>Value2</th><th>Rate</th></tr>
                </thead>
                <tbody></tbody>
            </table>
            
        </div>
        
    </div>



<script>
// function fetchReports() {
//     const start = document.getElementById("start_date").value;
//     const end = document.getElementById("end_date").value;
//     const container = document.getElementById("results-container");

//     // Show loading
//     container.innerHTML = `<p class="no-data">Loading...</p>`;
//     container.classList.add("show");

//     fetch(`/api/reports/?start_date=${start}&end_date=${end}`)
//         .then(res => res.json())
//         .then(data => {
//             container.innerHTML = ""; // clear loading message

//             if (!data.tables || data.tables.length === 0) {
//                 container.innerHTML = `<p class="no-data">No Data Found!</p>`;
//                 return;
//             }

//             const wrapper = document.createElement("div");
//             wrapper.className = "tables-wrapper";
//             container.appendChild(wrapper);

//             data.tables.forEach(tableData => {
//                 // Table Card Wrapper
//                 const tableCard = document.createElement("div");
//                 tableCard.style.display = "flex";
//                 tableCard.style.flexDirection = "column";
//                 tableCard.style.alignItems = "center";

//                 // Title
//                 const title = document.createElement("h3");
//                 title.innerText = tableData.name;
//                 title.style.marginBottom = "10px";
//                 tableCard.appendChild(title);

//                 // Table
//                 const table = document.createElement("table");
//                 table.className = "results-table show";

//                 // Header
//                 const thead = document.createElement("thead");
//                 const headerRow = document.createElement("tr");
//                 tableData.columns.forEach(col => {
//                     const th = document.createElement("th");
//                     th.innerText = col;
//                     headerRow.appendChild(th);
//                 });
//                 thead.appendChild(headerRow);
//                 table.appendChild(thead);

//                 // Body
//                 const tbody = document.createElement("tbody");
//                 tableData.rows.forEach(row => {
//                     const tr = document.createElement("tr");
//                     row.forEach(val => {
//                         const td = document.createElement("td");
//                         td.innerText = val;
//                         tr.appendChild(td);
//                     });
//                     tbody.appendChild(tr);
//                 });
//                 table.appendChild(tbody);

//                 // Add to wrapper
//                 tableCard.appendChild(table);
//                 wrapper.appendChild(tableCard);
//             });
//         })
//         .catch(err => {
//             console.error("Fetch error:", err);
//             container.innerHTML = `<p class="no-data">Error fetching data</p>`;
//         });
// }



async function fetchReports() {
    const start = document.getElementById("start_date").value;
    const end = document.getElementById("end_date").value;
    const container = document.getElementById("results-container");

    // Show loading
    container.innerHTML = `<p class="no-data">Loading...</p>`;
    container.classList.add("show");

    try {
        // Step 1: Ask Django for the API endpoint from Excel
        let res = await fetch("/api/get-endpoint/");
        let endpointData = await res.json();

        if (!endpointData.endpoint) {
            container.innerHTML = `<p class="no-data">Error: API endpoint not found</p>`;
            return;
        }

        // Step 2: Use the endpoint from Excel to fetch reports
        let reportsRes = await fetch(`${endpointData.endpoint}?start_date=${start}&end_date=${end}`);
        let data = await reportsRes.json();

        container.innerHTML = ""; // clear loading message

        if (!data.tables || data.tables.length === 0) {
            container.innerHTML = `<p class="no-data">No Data Found!</p>`;
            return;
        }

        const wrapper = document.createElement("div");
        wrapper.className = "tables-wrapper";
        container.appendChild(wrapper);

        data.tables.forEach(tableData => {
            const tableCard = document.createElement("div");
            tableCard.style.display = "flex";
            tableCard.style.flexDirection = "column";
            tableCard.style.alignItems = "center";

            const title = document.createElement("h3");
            title.innerText = tableData.name;
            title.style.marginBottom = "10px";
            tableCard.appendChild(title);

            const table = document.createElement("table");
            table.className = "results-table show";

            const thead = document.createElement("thead");
            const headerRow = document.createElement("tr");
            tableData.columns.forEach(col => {
                const th = document.createElement("th");
                th.innerText = col;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement("tbody");
            tableData.rows.forEach(row => {
                const tr = document.createElement("tr");
                row.forEach(val => {
                    const td = document.createElement("td");
                    td.innerText = val;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);

            tableCard.appendChild(table);
            wrapper.appendChild(tableCard);
        });
    } catch (err) {
        console.error("Fetch error:", err);
        container.innerHTML = `<p class="no-data">Error fetching data</p>`;
    }
}




</script>


</body>
</html>


